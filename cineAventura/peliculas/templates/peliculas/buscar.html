{# Template de b√∫squeda de pel√≠culas - Extiende la plantilla base de la aplicaci√≥n #}
{% extends 'peliculas/base.html' %}

{# Define el t√≠tulo de la p√°gina que aparecer√° en la pesta√±a del navegador #}
{% block title %}Buscar - Cine Aventura{% endblock %}

{# Bloque principal de contenido de la p√°gina #}
{% block content %}
<div class="search-page">
    {# Secci√≥n de encabezado de b√∫squeda con t√≠tulo y estad√≠sticas #}
    <div class="search-header">
        <div class="container">
            <h1 class="search-title">Resultados de B√∫squeda</h1>
            
            {# Muestra informaci√≥n solo si hay una consulta de b√∫squeda #}
            {% if query %}
            <p class="search-query">Buscando: "{{ query }}"</p>
            
            {# Verifica si hay un mensaje de error (ej: b√∫squeda muy corta) #}
            {% if mensaje_error %}
            <p class="search-error" style="color: #ff6b6b; font-size: 1.1em; margin-top: 10px;">{{ mensaje_error }}</p>
            {% else %}
            {# Muestra el conteo de resultados con pluralizaci√≥n autom√°tica #}
            <p class="search-count">{{ peliculas.count }} resultado{{ peliculas.count|pluralize }} encontrado{{ peliculas.count|pluralize }}</p>
            {% endif %}
            {% endif %}
        </div>
    </div>
    
    {# Contenedor principal de resultados #}
    <div class="container">
        {# Escenario 1: Mostrar mensaje de error si la b√∫squeda es inv√°lida #}
        {% if mensaje_error %}
        <div class="no-results-container">
            <p class="no-results-hint">Intenta con una b√∫squeda m√°s espec√≠fica (m√≠nimo 3 caracteres).</p>
        </div>
        
        {# Escenario 2: Mostrar grid de pel√≠culas si hay resultados #}
        {% elif peliculas %}
        <div class="movies-grid">
            {# Itera sobre cada pel√≠cula encontrada #}
            {% for pelicula in peliculas %}
            <div class="movie-card">
                {# Enlace a la p√°gina de detalle de la pel√≠cula #}
                <a href="{% url 'peliculas:detalle' pelicula.id %}" class="movie-link">
                    
                    {# Secci√≥n del p√≥ster de la pel√≠cula #}
                    <div class="movie-poster">
                        {# Muestra el p√≥ster si existe, sino muestra un placeholder #}
                        {% if pelicula.poster %}
                        <img src="{{ pelicula.poster }}" alt="{{ pelicula.titulo }}">
                        {% else %}
                        <div class="movie-poster-placeholder">
                            <span>üé¨</span>
                        </div>
                        {% endif %}
                        
                        {# Badge de calificaci√≥n flotante sobre el p√≥ster #}
                        <div class="movie-rating">
                            ‚≠ê {{ pelicula.calificacion_promedio|floatformat:1 }}
                        </div>
                    </div>
                    
                    {# Informaci√≥n textual de la pel√≠cula #}
                    <div class="movie-info">
                        <h3 class="movie-title">{{ pelicula.titulo }}</h3>
                        <p class="movie-year">{{ pelicula.a√±o }}</p>
                        
                        {# Muestra solo los primeros 2 g√©neros de la pel√≠cula #}
                        <div class="movie-genres">
                            {% for genero in pelicula.generos.all|slice:":2" %}
                            <span class="genre-tag">{{ genero.nombre }}</span>
                            {% endfor %}
                        </div>
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
        
        {# Escenario 3: No se encontraron resultados pero la b√∫squeda es v√°lida #}
        {% elif query %}
        <div class="no-results-container">
            <p class="no-results">No se encontraron pel√≠culas que coincidan con tu b√∫squeda.</p>
            <p class="no-results-hint">Intenta con otros t√©rminos o explora nuestros g√©neros.</p>
        </div>
        
        {# Escenario 4: P√°gina cargada sin b√∫squeda inicial #}
        {% else %}
        <div class="no-results-container">
            <p class="no-results-hint">Escribe algo en el buscador para encontrar pel√≠culas.</p>
        </div>
        {% endif %}
    </div>
</div>

{# Estilos inline para el mensaje de error (sobrescribe estilos previos) #}
<style>
.search-error {
    color: #ff6b6b !important;
    font-size: 1.1em;
    margin-top: 10px;
    font-weight: 500;
}
</style>
{% endblock %}