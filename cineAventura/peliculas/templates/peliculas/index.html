{% extends 'peliculas/base.html' %}

{% block content %}

{# Secci√≥n Hero #}
{# Hero Carousel #}
<section class="hero-carousel">
    {# Bot√≥n cerrar (opcional) #}
    <button class="carousel-close" onclick="document.querySelector('.hero-carousel').style.display='none'">√ó</button>
    
    {# Flechas de navegaci√≥n #}
    <button class="carousel-arrow carousel-arrow-prev" onclick="cambiarSlide(-1)">‚Äπ</button>
    <button class="carousel-arrow carousel-arrow-next" onclick="cambiarSlide(1)">‚Ä∫</button>
    
    {# Slides del carrusel #}
    {% for pelicula in peliculas_destacadas|slice:":5" %}
    <div class="carousel-slide {% if forloop.first %}active{% endif %}">
        {# Fondo con poster de la pel√≠cula #}
        <div class="carousel-background" style="background-image: url('{{ pelicula.poster }}');"></div>
        
        {# Contenido del slide #}
        <div class="carousel-content">
            <div class="container">
                <div class="carousel-info">
                    <span class="carousel-badge">Pel√≠cula Destacada</span>
                    <h1 class="carousel-title">{{ pelicula.titulo }}</h1>
                    <p class="carousel-description">
                        {{ pelicula.sinopsis|truncatewords:30 }}
                    </p>
                    
                    <div class="carousel-buttons">
                        {% if pelicula.trailer %}
                        <a href="{{ pelicula.trailer }}" target="_blank" class="carousel-btn carousel-btn-primary">
                            ‚ñ∂ Ver Ahora
                        </a>
                        {% endif %}
                        <a href="{% url 'peliculas:detalle' pelicula.id %}" class="carousel-btn carousel-btn-secondary">
                            ‚Ñπ M√°s Informaci√≥n
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
    
    {# Indicadores (dots) #}
    <div class="carousel-controls">
        {% for pelicula in peliculas_destacadas|slice:":5" %}
        <span class="carousel-dot {% if forloop.first %}active{% endif %}" onclick="irASlide({{ forloop.counter0 }})"></span>
        {% endfor %}
    </div>
</section>

{# JavaScript del Carrusel #}
<script>
let slideActual = 0;
const slides = document.querySelectorAll('.carousel-slide');
const dots = document.querySelectorAll('.carousel-dot');
const totalSlides = slides.length;

function mostrarSlide(n) {
    // Ocultar todos los slides
    slides.forEach(slide => slide.classList.remove('active'));
    dots.forEach(dot => dot.classList.remove('active'));
    
    // Asegurar que n est√© en rango
    if (n >= totalSlides) { slideActual = 0; }
    if (n < 0) { slideActual = totalSlides - 1; }
    
    // Mostrar slide actual
    slides[slideActual].classList.add('active');
    dots[slideActual].classList.add('active');
}

function cambiarSlide(direccion) {
    slideActual += direccion;
    mostrarSlide(slideActual);
}

function irASlide(n) {
    slideActual = n;
    mostrarSlide(slideActual);
}

// Auto-play: cambiar slide cada 5 segundos
let autoplay = setInterval(() => {
    cambiarSlide(1);
}, 5000);

// Pausar autoplay al pasar el mouse
document.querySelector('.hero-carousel').addEventListener('mouseenter', () => {
    clearInterval(autoplay);
});

// Reanudar autoplay al quitar el mouse
document.querySelector('.hero-carousel').addEventListener('mouseleave', () => {
    autoplay = setInterval(() => {
        cambiarSlide(1);
    }, 5000);
});

// Controles con teclado
document.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowLeft') cambiarSlide(-1);
    if (e.key === 'ArrowRight') cambiarSlide(1);
});
</script>

{# Secci√≥n de Pel√≠culas Destacadas #}
<section class="section">
    <div class="container">
        <h2 class="section-title">Pel√≠culas <span class="highlight">Destacadas</span></h2>
        
        <div class="movies-grid">
            {% for pelicula in peliculas_destacadas %}
            <div class="movie-card">
                <a href="{% url 'peliculas:detalle' pelicula.id %}" class="movie-link">
                    
                    <div class="movie-poster">
                        {# Badge verde "Destacada" #}
                        <span class="badge-destacada">Destacada</span>
                        
                        {% if pelicula.poster %}
                        <img src="{{ pelicula.poster }}" alt="{{ pelicula.titulo }}">
                        {% else %}
                        <div class="movie-poster-placeholder">
                            <span>üé¨</span>
                        </div>
                        {% endif %}
                        
                        <div class="movie-rating">
                            ‚≠ê {{ pelicula.calificacion_promedio|floatformat:1 }}
                        </div>
                    </div>
                    
                    <div class="movie-info">
                        <h3 class="movie-title">{{ pelicula.titulo }}</h3>
                        
                        {# Metadatos: A√±o, Duraci√≥n, Calificaci√≥n #}
                        <div class="movie-meta-info">
                            <span>üìÖ {{ pelicula.a√±o }}</span>
                            <span>‚è±Ô∏è {{ pelicula.duracion }} min</span>
                        </div>
                        
                        {# Sinopsis corta (primeras 3 l√≠neas) #}
                        <p class="movie-synopsis-short">{{ pelicula.sinopsis|truncatewords:20 }}</p>
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

{# Secci√≥n de Pel√≠culas Recientes #}
<section class="section section-alt">
    <div class="container">
        <h2 class="section-title">üÜï Agregadas <span class="highlight">Recientemente</span></h2>
        
        <div class="movies-grid">
            {% for pelicula in peliculas_recientes %}
            <div class="movie-card">
                <a href="{% url 'peliculas:detalle' pelicula.id %}" class="movie-link">
                    
                    <div class="movie-poster">
                        {% if pelicula.poster %}
                        <img src="{{ pelicula.poster }}" alt="{{ pelicula.titulo }}">
                        {% else %}
                        <div class="movie-poster-placeholder">
                            <span>üé¨</span>
                        </div>
                        {% endif %}
                        
                        <div class="movie-rating">
                            ‚≠ê {{ pelicula.calificacion_promedio|floatformat:1 }}
                        </div>
                    </div>
                    
                    <div class="movie-info">
                        <h3 class="movie-title">{{ pelicula.titulo }}</h3>
                        
                        {# Metadatos: A√±o, Duraci√≥n #}
                        <div class="movie-meta-info">
                            <span>üìÖ {{ pelicula.a√±o }}</span>
                            <span>‚è±Ô∏è {{ pelicula.duracion }} min</span>
                        </div>
                        
                        {# Sinopsis corta #}
                        <p class="movie-synopsis-short">{{ pelicula.sinopsis|truncatewords:20 }}</p>
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{# Secci√≥n de Cat√°logo Completo #}
<section class="section">
    <div class="container" style="text-align: center;">
        <h2 class="section-title">Cat√°logo <span class="highlight">Completo</span></h2>
        <p style="color: #6c757d; font-size: 18px; margin-bottom: 30px;">
            Explora nuestra colecci√≥n completa de pel√≠culas de aventura
        </p>
        <a href="{% url 'peliculas:catalogo' %}" class="btn-primary" style="display: inline-block; padding: 15px 40px; font-size: 18px;">
            Ver Cat√°logo Completo ‚Üí
        </a>
    </div>
</section>
{% endblock %}